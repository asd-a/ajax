(function(){var t,k,s,g,d,c,B,$,f,b=[].slice;function e(){this.commonWhiteList="kbd|b|i|strong|em|sup|sub|br|code|del|a|hr|small",this.blockHtmlTags="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|address|form|fieldset|iframe|hr|legend|article|section|nav|aside|hgroup|header|footer|figcaption|svg|script|noscript",this.specialWhiteList={table:"table|tbody|thead|tfoot|tr|td|th"},this.hooks={},this.html=!1,this.line=!1,this.blockParsers=[["code",10],["shtml",20],["pre",30],["ahtml",40],["shr",50],["list",60],["math",70],["html",80],["footnote",90],["definition",100],["quote",110],["table",120],["sh",130],["mh",140],["dhr",150],["default",9999]],this.parsers={}}f=function(t){return t.charAt(0).toUpperCase()+t.substring(1)},c=function(t){return t.replace(/[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},d="A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",B=function(t,e,n){var s,r,l,i,o,a;if(t instanceof Array)if(e instanceof Array)for(s=r=0,i=t.length;r<i;s=++r)a=t[s],n=B(a,e[s],n);else for(l=0,o=t.length;l<o;l++)a=t[l],n=B(a,e,n);else t=c(t),n=n.replace(new RegExp(t,"g"),e.replace(/\$/g,"$$$$"));return n},g=function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},$=function(t,e){var n,s,r,l,i;if(null==e&&(e=null),null==e)return t.replace(/^\s*/,"").replace(/\s*$/,"");for(i="",s=r=0,l=e.length-1;0<=l?r<=l:l<=r;s=0<=l?++r:--r)n=e[s],i+=c(n);return i="["+i+"]*",t.replace(new RegExp("^"+i),"").replace(new RegExp(i+"$"),"")},k=function(t){var e,n,s,r=[];if(t instanceof Array)for(n=e=0,s=t.length;e<s;n=++e)t[n],r.push(n);else for(n in t)r.push(n);return r},s=function(t){var e,n,s,r,l=[];if(t instanceof Array)for(n=0,s=t.length;n<s;n++)r=t[n],l.push(r);else for(e in t)r=t[e],l.push(r);return l},e.prototype.makeHtml=function(t){var e,n,s,r,l;for(this.footnotes=[],this.definitions={},this.holders={},this.uniqid=Math.ceil(1e7*Math.random())+Math.ceil(1e7*Math.random()),this.id=0,this.blockParsers.sort(function(t,e){return t[1]<e[1]?-1:1}),e=0,n=(l=this.blockParsers).length;e<n;e++)s=(r=l[e])[0],void 0!==r[2]?this.parsers[s]=r[2]:this.parsers[s]=this["parseBlock"+f(s)].bind(this);return t=this.initText(t),t=this.parse(t),t=this.makeFootnotes(t),t=this.optimizeLines(t),this.call("makeHtml",t)},e.prototype.enableHtml=function(t){this.html=null==t||t},e.prototype.enableLine=function(t){this.line=null==t||t},e.prototype.hook=function(t,e){return null==this.hooks[t]&&(this.hooks[t]=[]),this.hooks[t].push(e)},e.prototype.makeHolder=function(t){var e="|\r"+this.uniqid+this.id+"\r|";return this.id+=1,this.holders[e]=t,e},e.prototype.initText=function(t){return t.replace(/\t/g,"    ").replace(/\r/g,"").replace(/(\u000A|\u000D|\u2028|\u2029)/g,"\n")},e.prototype.makeFootnotes=function(t){var e,n;if(0<this.footnotes.length){for(t+='<div class="footnotes"><hr><ol>',e=1;n=this.footnotes.shift();)"string"==typeof n?n+=' <a href="#fnref-'+e+'" class="footnote-backref">&#8617;</a>':(n[n.length-1]+=' <a href="#fnref-'+e+'" class="footnote-backref">&#8617;</a>',n=1<n.length?this.parse(n.join("\n")):this.parseInline(n[0])),t+='<li id="fn-'+e+'">'+n+"</li>",e+=1;t+="</ol></div>"}return t},e.prototype.parse=function(t,e,n){var s,r,l,i,o,a,c,h,p,u;for(null==e&&(e=!1),null==n&&(n=0),a=[],s=this.parseBlock(t,a),l="",e&&1===s.length&&"normal"===s[0][0]&&(s[0][3]=!0),i=0,o=s.length;i<o;i++)p=(r=s[i])[0],h=r[1],c=r[2],u=r[3],r=a.slice(h,c+1),p="parse"+f(p),r=this.call("before"+f(p),r,u),c=this[p](r,u,h+n,c+n),l+=this.call("after"+f(p),c,u);return l},e.prototype.call=function(){var t,e,n,s=arguments[0],r=2<=arguments.length?b.call(arguments,1):[],l=r[0];if(null==this.hooks[s])return l;for(t=0,e=(n=this.hooks[s]).length;t<e;t++)l=n[t].apply(this,r),r[0]=l;return l},e.prototype.releaseHolder=function(t,e){var n;for(null==e&&(e=!0),n=0;0<=t.indexOf("\r")&&n<10;)t=B(k(this.holders),s(this.holders),t),n+=1;return e&&(this.holders={}),t},e.prototype.markLine=function(t,e){return null==e&&(e=-1),this.line?'<span class="line" data-start="'+t+'" data-end="'+(e=e<0?t:e)+'" data-id="'+this.uniqid+'"></span>':""},e.prototype.markLines=function(t,e){var n,s=-1;return this.line?t.map((n=this,function(t){return s+=1,n.markLine(e+s)+t})):t},e.prototype.optimizeLines=function(t){var n=0,e=new RegExp('class="line" data\\-start="([0-9]+)" data\\-end="([0-9]+)" (data\\-id="'+this.uniqid+'")',"g");return this.line?t.replace(e,function(){var t=1<=arguments.length?b.call(arguments,0):[],e=n!==parseInt(t[1])?'class="line" data-start="'+n+'" data-start-original="'+t[1]+'" data-end="'+t[2]+'" '+t[3]:t[0];return n=1+parseInt(t[2]),e}):t},e.prototype.parseInline=function(t,e,n,s){var r,l,i,o,a,c,h,p,u,f,k,m;return null==e&&(e=""),null==n&&(n=!0),null==s&&(s=!0),t=(t=(t=(t=(t=(t=this.call("beforeParseInline",t)).replace(/(^|[^\\])(`+)(.+?)\2/gm,(r=this,function(){var t=1<=arguments.length?b.call(arguments,0):[];return t[1]+r.makeHolder("<code>"+g(t[3])+"</code>")}))).replace(/(^|[^\\])(\$+)(.+?)\2/gm,(l=this,function(){var t=1<=arguments.length?b.call(arguments,0):[];return t[1]+l.makeHolder(t[2]+g(t[3])+t[2])}))).replace(/\\(.)/g,(i=this,function(){var t=1<=arguments.length?b.call(arguments,0):[],e=t[1].match(/^[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]$/)?"":"\\",t=g(t[1]);return t=t.replace(/\$/g,"&dollar;"),i.makeHolder(e+t)}))).replace(/<(https?:\/\/.+)>/gi,(o=this,function(){var t=1<=arguments.length?b.call(arguments,0):[],e=o.cleanUrl(t[1]),t=o.call("parseLink",t[1]);return o.makeHolder('<a href="'+e+'">'+t+"</a>")}))).replace(/<(\/?)([a-z0-9-]+)(\s+[^>]*)?>/gi,(a=this,function(){var t=1<=arguments.length?b.call(arguments,0):[];return a.html||0<=("|"+a.commonWhiteList+"|"+e+"|").indexOf("|"+t[2].toLowerCase()+"|")?a.makeHolder(t[0]):a.makeHolder(g(t[0]))})),this.html&&(t=t.replace(/<!\-\-(.*?)\-\->/g,(c=this,function(){var t=1<=arguments.length?b.call(arguments,0):[];return c.makeHolder(t[0])}))),t=(t=(t=(t=(t=(t=B(["<",">"],["&lt;","&gt;"],t)).replace(/\[\^((?:[^\]]|\\\]|\\\[)+?)\]/g,(h=this,function(){var t=1<=arguments.length?b.call(arguments,0):[],e=h.footnotes.indexOf(t[1]);return e<0&&(e=h.footnotes.length+1,h.footnotes.push(h.parseInline(t[1],"",!1))),h.makeHolder('<sup id="fnref-'+e+'"><a href="#fn-'+e+'" class="footnote-ref">'+e+"</a></sup>")}))).replace(/!\[((?:[^\]]|\\\]|\\\[)*?)\]\(((?:[^\)]|\\\)|\\\()+?)\)/g,(p=this,function(){var t=1<=arguments.length?b.call(arguments,0):[],e=g(p.escapeBracket(t[1])),t=p.escapeBracket(t[2]);return t=p.cleanUrl(t),p.makeHolder('<img src="'+t+'" alt="'+e+'" title="'+e+'">')}))).replace(/!\[((?:[^\]]|\\\]|\\\[)*?)\]\[((?:[^\]]|\\\]|\\\[)+?)\]/g,(u=this,function(){var t=1<=arguments.length?b.call(arguments,0):[],e=g(u.escapeBracket(t[1])),e=null!=u.definitions[t[2]]?'<img src="'+u.definitions[t[2]]+'" alt="'+e+'" title="'+e+'">':e;return u.makeHolder(e)}))).replace(/\[((?:[^\]]|\\\]|\\\[)+?)\]\(((?:[^\)]|\\\)|\\\()+?)\)/g,(f=this,function(){var t=1<=arguments.length?b.call(arguments,0):[],e=f.parseInline(f.escapeBracket(t[1]),"",!1,!1),t=f.escapeBracket(t[2]);return t=f.cleanUrl(t),f.makeHolder('<a href="'+t+'">'+e+"</a>")}))).replace(/\[((?:[^\]]|\\\]|\\\[)+?)\]\[((?:[^\]]|\\\]|\\\[)+?)\]/g,(k=this,function(){var t=1<=arguments.length?b.call(arguments,0):[],e=k.parseInline(k.escapeBracket(t[1]),"",!1,!1),e=null!=k.definitions[t[2]]?'<a href="'+k.definitions[t[2]]+'">'+e+"</a>":e;return k.makeHolder(e)})),t=(t=this.parseInlineCallback(t)).replace(/<([_a-z0-9-\.\+]+@[^@]+\.[a-z]{2,})>/gi,'<a href="mailto:$1">$1</a>'),s&&(s=new RegExp('(^|[^"])((https?):['+d+'_0-9-\\./%#!@\\?\\+=~\\|\\,&\\(\\)]+)($|[^"])',"ig"),t=t.replace(s,(m=this,function(){var t=1<=arguments.length?b.call(arguments,0):[],e=m.call("parseLink",t[2]);return t[1]+'<a href="'+t[2]+'">'+e+"</a>"+t[4]}))),t=this.call("afterParseInlineBeforeRelease",t),t=this.releaseHolder(t,n),t=this.call("afterParseInline",t)},e.prototype.parseInlineCallback=function(t){var e,n,s,r,l,i,o;return t=(t=(t=(t=(t=(t=(t=t.replace(/(\*{3})((?:.|\r)+?)\1/gm,(e=this,function(){var t=1<=arguments.length?b.call(arguments,0):[];return"<strong><em>"+e.parseInlineCallback(t[2])+"</em></strong>"}))).replace(/(\*{2})((?:.|\r)+?)\1/gm,(n=this,function(){var t=1<=arguments.length?b.call(arguments,0):[];return"<strong>"+n.parseInlineCallback(t[2])+"</strong>"}))).replace(/(\*)((?:.|\r)+?)\1/gm,(s=this,function(){var t=1<=arguments.length?b.call(arguments,0):[];return"<em>"+s.parseInlineCallback(t[2])+"</em>"}))).replace(/(\s+|^)(_{3})((?:.|\r)+?)\2(\s+|$)/gm,(r=this,function(){var t=1<=arguments.length?b.call(arguments,0):[];return t[1]+"<strong><em>"+r.parseInlineCallback(t[3])+"</em></strong>"+t[4]}))).replace(/(\s+|^)(_{2})((?:.|\r)+?)\2(\s+|$)/gm,(l=this,function(){var t=1<=arguments.length?b.call(arguments,0):[];return t[1]+"<strong>"+l.parseInlineCallback(t[3])+"</strong>"+t[4]}))).replace(/(\s+|^)(_)((?:.|\r)+?)\2(\s+|$)/gm,(i=this,function(){var t=1<=arguments.length?b.call(arguments,0):[];return t[1]+"<em>"+i.parseInlineCallback(t[3])+"</em>"+t[4]}))).replace(/(~{2})((?:.|\r)+?)\1/gm,(o=this,function(){var t=1<=arguments.length?b.call(arguments,0):[];return"<del>"+o.parseInlineCallback(t[2])+"</del>"}))},e.prototype.parseBlock=function(t,e){for(var n,s,r,l,i,o,a,c,h,p=t.split("\n"),u=0,f=p.length;u<f;u++)i=p[u],e.push(i);for(this.blocks=[],this.current="normal",this.pos=-1,h={special:k(this.specialWhiteList).join("|"),empty:0,html:!1},s=r=0,l=e.length;r<l;s=++r)if(i=e[s],n=this.getBlock(),null!=n&&(n=n.slice(0)),"normal"===this.current||this.parsers[this.current](n,s,i,h,e))for(o in c=this.parsers)if(a=c[o],o!==this.current&&!a(n,s,i,h,e))break;return this.optimizeBlocks(this.blocks,e)},e.prototype.parseBlockList=function(t,e,n,s){var r;if(this.isBlock("list")&&!n.match(/^\s*\[((?:[^\]]|\\\]|\\\[)+?)\]:\s*(.+)$/)){if(s.empty<=1&&(r=n.match(/^(\s+)/))&&r[1].length>t[3])return s.empty=0,this.setBlock(e),!1;if(n.match(/^\s*$/)&&0===s.empty)return s.empty+=1,this.setBlock(e),!1}return!(r=n.match(/^(\s*)((?:[0-9]+\.)|\-|\+|\*)\s+/i))||(r=r[1].length,s.empty=0,this.isBlock("list")?this.setBlock(e,r):this.startBlock("list",e,r),!1)},e.prototype.parseBlockCode=function(t,e,n){var s;return(n=n.match(/^(\s*)(~{3,}|`{3,})([^`~]*)$/i))?(this.isBlock("code")?(s=t[3][2])?this.combineBlock().setBlock(e):this.setBlock(e).endBlock():(s=!1,this.isBlock("list")&&(s=0<(t=t[3])&&n[1].length>=t||n[1].length>t),this.startBlock("code",e,[n[1],n[3],s])),!1):!this.isBlock("code")||(this.setBlock(e),!1)},e.prototype.parseBlockShtml=function(t,e,n,s){if(this.html){if(n.match(/^(\s*)!!!(\s*)$/))return this.isBlock("shtml")?this.setBlock(e).endBlock():this.startBlock("shtml",e),!1;if(this.isBlock("shtml"))return this.setBlock(e),!1}return!0},e.prototype.parseBlockAhtml=function(t,e,n,s){var r,l,i,o;if(this.html)if(o=new RegExp("^\\s*<("+this.blockHtmlTags+")(\\s+[^>]*)?>","i"),o=n.match(o)){if(this.isBlock("ahtml"))return this.setBlock(e),!1;if(void 0===o[2]||"/"!==o[2]){for(this.startBlock("ahtml",e),r=new RegExp("\\s*<("+this.blockHtmlTags+")(\\s+[^>]*)?>","ig");i=r.exec(n);)l=i[1];return 0<=n.indexOf("</"+l+">")?this.endBlock():s.html=l,!1}}else{if(s.html&&0<=n.indexOf("</"+s.html+">"))return this.setBlock(e).endBlock(),s.html=!1;if(this.isBlock("ahtml"))return this.setBlock(e),!1;if(o=n.match(/^\s*<!\-\-(.*?)\-\->\s*$/))return this.startBlock("ahtml",e).endBlock(),!1}return!0},e.prototype.parseBlockMath=function(t,e,n){return n.match(/^(\s*)\$\$(\s*)$/)?(this.isBlock("math")?this.setBlock(e).endBlock():this.startBlock("math",e),!1):!this.isBlock("math")||(this.setBlock(e),!1)},e.prototype.parseBlockPre=function(t,e,n,s){return n.match(/^ {4}/)?(this.isBlock("pre")?this.setBlock(e):this.startBlock("pre",e),!1):!this.isBlock("pre")||!n.match(/^\s*$/)||(this.setBlock(e),!1)},e.prototype.parseBlockHtml=function(t,e,n,s){var r,l;return(r=n.match(new RegExp("^\\s*<("+s.special+")(\\s+[^>]*)?>","i")))?(l=r[1].toLowerCase(),this.isBlock("html",l)||this.isBlock("pre")||this.startBlock("html",e,l),!1):(r=n.match(new RegExp("</("+s.special+")>\\s*$","i")))?(l=r[1].toLowerCase(),this.isBlock("html",l)&&this.setBlock(e).endBlock(),!1):!this.isBlock("html")||(this.setBlock(e),!1)},e.prototype.parseBlockFootnote=function(t,e,n){var s;return!(s=n.match(/^\[\^((?:[^\]]|\\\]|\\\[)+?)\]:/))||(n=s[0].length-1,this.startBlock("footnote",e,[n,s[1]]),!1)},e.prototype.parseBlockDefinition=function(t,e,n){return!(n=n.match(/^\s*\[((?:[^\]]|\\\]|\\\[)+?)\]:\s*(.+)$/))||(this.definitions[n[1]]=this.cleanUrl(n[2]),this.startBlock("definition",e).endBlock(),!1)},e.prototype.parseBlockQuote=function(t,e,n){return!(n=n.match(/^(\s*)>/))||(this.isBlock("list")&&0<n[1].length||this.isBlock("quote")?this.setBlock(e):this.startBlock("quote",e),!1)},e.prototype.parseBlockTable=function(t,e,n,s,r){var l,i,o,a,c,h;if(c=n.match(/^((?:(?:(?:\||\+)(?:[ :]*\-+[ :]*)(?:\||\+))|(?:(?:[ :]*\-+[ :]*)(?:\||\+)(?:[ :]*\-+[ :]*))|(?:(?:[ :]*\-+[ :]*)(?:\||\+))|(?:(?:\||\+)(?:[ :]*\-+[ :]*)))+)$/)){if(this.isBlock("table"))t[3][0].push(t[3][2]),t[3][2]+=1,this.setBlock(e,t[3]);else{for(n=0,null==t||"normal"!==t[0]||r[t[2]].match(/^\s*$/)?this.startBlock("table",e):(n=1,this.backBlock(1,"table")),"|"===c[1][0]&&(c[1]=c[1].substring(1),"|"===c[1][c[1].length-1]&&(c[1]=c[1].substring(0,c[1].length-1))),i=[],o=0,a=(h=c[1].split(/\+|\|/)).length;o<a;o++)l="none",(c=h[o].match(/^\s*(:?)\-+(:?)\s*$/))&&(c[1]&&c[2]?l="center":c[1]?l="left":c[2]&&(l="right")),i.push(l);this.setBlock(e,[[n],i,n+1])}return!1}return!0},e.prototype.parseBlockSh=function(t,e,n){return!(n=n.match(/^(#+)(.*)$/))||(n=Math.min(n[1].length,6),this.startBlock("sh",e,n).endBlock(),!1)},e.prototype.parseBlockMh=function(t,e,n,s,r){return!((n=n.match(/^\s*((=|-){2,})\s*$/))&&null!=t&&"normal"===t[0]&&!r[t[2]].match(/^\s*$/))||(this.isBlock("normal")?this.backBlock(1,"mh","="===n[1][0]?1:2).setBlock(e).endBlock():this.startBlock("normal",e),!1)},e.prototype.parseBlockShr=function(t,e,n){return!n.match(/^(\* *){3,}\s*$/)||(this.startBlock("hr",e).endBlock(),!1)},e.prototype.parseBlockDhr=function(t,e,n){return!n.match(/^(- *){3,}\s*$/)||(this.startBlock("hr",e).endBlock(),!1)},e.prototype.parseBlockDefault=function(t,e,n,s){return this.isBlock("footnote")?n.match(/^(\s*)/)[1].length>=t[3][0]?this.setBlock(e):this.startBlock("normal",e):this.isBlock("table")?0<=n.indexOf("|")?(t[3][2]+=1,this.setBlock(e,t[3])):this.startBlock("normal",e):this.isBlock("quote")?n.match(/^(\s*)$/)?this.startBlock("normal",e):this.setBlock(e):null==t||"normal"!==t[0]?this.startBlock("normal",e):this.setBlock(e),!0},e.prototype.optimizeBlocks=function(t,e){var n,s,r,l,i,o,a,c,h=t.slice(0),p=e.slice(0);for(h=this.call("beforeOptimizeBlocks",h,p),r=0;null!=h[r];)l=!1,n=h[r],o=null!=h[r-1]?h[r-1]:null,i=null!=h[r+1]?h[r+1]:null,c=n[0],s=n[1],a=n[2],"pre"===c&&p.slice(n[1],n[2]+1).reduce(function(t,e){return e.match(/^\s*$/)&&t},!0)&&(n[0]=c="normal"),"normal"===c&&(c=["list","quote"],s===a&&p[s].match(/^\s*$/)&&null!=o&&null!=i&&o[0]===i[0]&&0<=c.indexOf(o[0])&&(h[r-1]=[o[0],o[1],i[2],null],h.splice(r,2),l=!0)),l||(r+=1);return this.call("afterOptimizeBlocks",h,p)},e.prototype.parseCode=function(t,e,n){var s,r,l,i=e[0],o=e[1];return o=$(o),s=i.length,o.match(/^[_a-z0-9-\+\#\:\.]+$/i)?1<(e=o.split(":")).length&&(o=e[0],l=e[1],o=$(o),l=$(l)):o=null,r=!0,t=t.slice(1,-1).map(function(t){return t=t.replace(new RegExp("/^[ ]{"+s+"}/"),""),r&&!t.match(/^\s*$/)&&(r=!1),g(t)}),n=this.markLines(t,n+1).join("\n"),r?"":"<pre><code"+(o?' class="'+o+'"':"")+(l?' rel="'+l+'"':"")+">"+n+"</code></pre>"},e.prototype.parsePre=function(t,e,n){return t=t.map(function(t){return g(t.substring(4))}),(n=this.markLines(t,n).join("\n")).match(/^\s*$/)?"":"<pre><code>"+n+"</code></pre>"},e.prototype.parseAhtml=function(t,e,n){return $(this.markLines(t,n).join("\n"))},e.prototype.parseShtml=function(t,e,n){return $(this.markLines(t.slice(1,-1),n+1).join("\n"))},e.prototype.parseMath=function(t,e,n,s){return"<p>"+this.markLine(n,s)+g(t.join("\n"))+"</p>"},e.prototype.parseSh=function(t,e,n,s){t=this.markLine(n,s)+this.parseInline($(t[0],"# "));return t.match(/^\s*$/)?"":"<h"+e+">"+t+"</h"+e+">"},e.prototype.parseMh=function(t,e,n,s){return this.parseSh(t,e,n,s)},e.prototype.parseQuote=function(t,e,n){return(t=(t=t.map(function(t){return t.replace(/^\s*> ?/,"")})).join("\n")).match(/^\s*$/)?"":"<blockquote>"+this.parse(t,!0,n)+"</blockquote>"},e.prototype.parseList=function(t,e,n){for(var s,r,l,i,o,a,c,h,p,u,f,k,m="",g=99999,d=99999,B=!1,b=!1,y=[],v=s=0,$=t.length;s<$;v=++s)(h=(c=t[v]).match(/^(\s*)((?:[0-9]+\.?)|\-|\+|\*)(\s+)(.*)$/i))?(u=h[1].length,k=0<="+-*".indexOf(h[2])?"ul":"ol",g=Math.min(u,g),B=!0,0<u&&(d=Math.min(u,d),b=!0),y.push([u,k,c,h[4]])):(y.push(c),(h=c.match(/^(\s*)/))&&0<(u=h[1].length)&&(d=Math.min(u,d),b=!0));for(g=B?g:0,d=b?d:g,l="",i=[],v=r=o=0,a=y.length;r<a;v=++r)(p=y[v])instanceof Array?(u=p[0],k=p[1],c=p[2],f=p[3],u!==g?i.push(c.replace(new RegExp("^\\s{"+d+"}"),"")):(0<i.length&&(m+="<li>"+this.parse(i.join("\n"),!0,n+o)+"</li>"),l!==k&&(l&&(m+="</"+l+">"),m+="<"+k+">"),o=v,i=[f],l=k)):i.push(p.replace(new RegExp("^\\s{"+d+"}"),""));return 0<i.length&&(m+="<li>"+this.parse(i.join("\n"),!0,n+o)+"</li></"+l+">"),m},e.prototype.parseTable=function(t,e,n){for(var s,r,l,i,o,a,c,h,p,u,f,k=e[0],m=e[1],g=0<k.length&&0<k.reduce(function(t,e){return e+t}),d="<table>",B=!g||null,b=!1,y=r=0,v=t.length;r<v;y=++r)if(a=t[y],0<=k.indexOf(y))g&&b&&(B=!(g=!1));else{for(b=!0,"|"===(a=$(a))[0]&&"|"===(a=a.substring(1))[a.length-1]&&(a=a.substring(0,a.length-1)),s={},i=-1,l=0,o=(p=a.split("|").map(function(t){return t.match(/^\s*$/)?" ":$(t)})).length;l<o;l++)0<(h=p[l]).length?s[i+=1]=[null!=s[i]?s[i][0]+1:1,h]:null!=s[i]?s[i][0]+=1:s[0]=[1,h];for(y in g?d+="<thead>":B&&(d+="<tbody>"),d+="<tr",this.line&&(d+=' class="line" data-start="'+(n+y)+'" data-end="'+(n+y)+'" data-id="'+this.uniqid+'"'),d+=">",s)c=(u=s[y])[0],f=u[1],d+="<"+(u=g?"th":"td"),1<c&&(d+=' colspan="'+c+'"'),null!=m[y]&&"none"!==m[y]&&(d+=' align="'+m[y]+'"'),d+=">"+this.parseInline(f)+"</"+u+">";d+="</tr>",g?d+="</thead>":B=B&&!1}return null!==B&&(d+="</tbody>"),d+"</table>"},e.prototype.parseHr=function(t,e,n){return this.line?'<hr class="line" data-start="'+n+'" data-end="'+n+'">':"<hr>"},e.prototype.parseNormal=function(t,e,n){var s,r;return null==e&&(e=!1),s=0,t=t.map((r=this,function(t){return(t=r.parseInline(t)).match(/^\s*$/)||(t=r.markLine(n+s)+t),s+=1,t})),(t=(t=(t=$(t.join("\n"))).replace(/(\n\s*){2,}/g,"</p><p>")).replace(/\n/g,"<br>")).match(/^\s*$/)?"":e?t:"<p>"+t+"</p>"},e.prototype.parseFootnote=function(t,e){e[0];var e=e[1],e=this.footnotes.indexOf(e);return 0<=e&&((t=t.slice(0))[0]=t[0].replace(/^\[\^((?:[^\]]|\]|\[)+?)\]:/,""),this.footnotes[e]=t),""},e.prototype.parseDefinition=function(){return""},e.prototype.parseHtml=function(t,e,n){var s;return t=t.map((s=this,function(t){return s.parseInline(t,null!=s.specialWhiteList[e]?s.specialWhiteList[e]:"")})),this.markLines(t,n).join("\n")},e.prototype.cleanUrl=function(t){var e=new RegExp("^\\s*((http|https|ftp|mailto):["+d+"_a-z0-9-:\\.\\*/%#;!@\\?\\+=~\\|\\,&\\(\\)]+)","i"),n=new RegExp("^\\s*(["+d+"_a-z0-9-:\\.\\*/%#!@\\?\\+=~\\|\\,&]+)","i");return(e=t.match(e))||(e=t.match(n))?e[1]:"#"},e.prototype.escapeBracket=function(t){return B(["\\[","\\]","\\(","\\)"],["[","]","(",")"],t)},e.prototype.startBlock=function(t,e,n){return null==n&&(n=null),this.pos+=1,this.current=t,this.blocks.push([t,e,e,n]),this},e.prototype.endBlock=function(){return this.current="normal",this},e.prototype.isBlock=function(t,e){return null==e&&(e=null),this.current===t&&(null===e||this.blocks[this.pos][3]===e)},e.prototype.getBlock=function(){return null!=this.blocks[this.pos]?this.blocks[this.pos]:null},e.prototype.setBlock=function(t,e){return null==t&&(t=null),null==e&&(e=null),null!==t&&(this.blocks[this.pos][2]=t),null!==e&&(this.blocks[this.pos][3]=e),this},e.prototype.backBlock=function(t,e,n){var s;return null==n&&(n=null),this.pos<0?this.startBlock(e,0,n):(s=this.blocks[this.pos][2],this.blocks[this.pos][2]=s-t,n=[e,s-t+1,s,n],this.blocks[this.pos][1]<=this.blocks[this.pos][2]?(this.pos+=1,this.blocks.push(n)):this.blocks[this.pos]=n,this.current=e,this)},e.prototype.combineBlock=function(){var t,e;return this.pos<1||(e=this.blocks[this.pos-1].slice(0),t=this.blocks[this.pos].slice(0),e[2]=t[2],this.blocks[this.pos-1]=e,this.current=e[0],this.blocks=this.blocks.slice(0,-1),--this.pos),this},t=e,"undefined"!=typeof module&&null!==module?module.exports=t:"undefined"!=typeof window&&null!==window&&(window.HyperDown=t)}).call(this);